package tms;

import cre.ComplexRole;
import cre.Credential1;
import cre.Credential2;
import cre.Credential3;
import cre.Credentials;
import cre.Role;
import cre.RoleName;
import cre.Roles;
import cre.TMSPrincipal;

public class SemanticsComputation1 {

	/**
	 * @param args
	 */
	static Credentials cres = new Credentials(); 
	static Roles roles = new Roles();
	static boolean change = true;
	static boolean changeall = true;
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		//credential1:EOrg.preferred<-EOrg.university.student;
		//credential2:EOrg.university<-ABU.accredited;
		//credential3:ABU.accredited<-StateU;
		//credential4:StateU.student<-RegistrarB.stude                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     nt;
		//credential5:RegistrarB.student<-Alice;
		
		//EOrg.preferred
		TMSPrincipal p1 = new TMSPrincipal("EOrg");
		RoleName rn1 = new RoleName("preferred");
		Role r1 = new Role(p1,rn1);
		roles.addRole(r1);
		//EOrg.university
		TMSPrincipal p2 = new TMSPrincipal("EOrg");
		RoleName rn2 = new RoleName("university");
		Role r2 = new Role(p2,rn2);
		roles.addRole(r2);
		//EOrg.university.student
		RoleName rn3 = new RoleName("student");
		ComplexRole cr = new ComplexRole(r2,rn3);
		//credential1:EOrg.preferred<-EOrg.university.student;
		Credential3 c1 = new Credential3(r1,cr);
		//ABU.accredited
		TMSPrincipal p4 = new TMSPrincipal("ABU");
		RoleName rn4 = new RoleName("accredited");
		Role r4 = new Role(p4, rn4);
		roles.addRole(r4);
		//credential2:EOrg.university<-ABU.accredited;
		Credential2 c2 = new Credential2(r2,r4);
		//StateU
		TMSPrincipal p5 = new TMSPrincipal("StateU");
		//credential3:ABU.accredited<-StateU;
		Credential1 c3 = new Credential1(r4,p5);
		//StateU.student
		RoleName rn5 = new RoleName("student");
		Role r5 = new Role(p5,rn5);
		roles.addRole(r5);
		//RegistrarB.student
		TMSPrincipal p6 = new TMSPrincipal("RegistrarB");
		Role r6 = new Role(p6,rn5);
		roles.addRole(r6);
		//credential4:StateU.student<-RegistrarB.student;
		Credential2 c4 = new Credential2(r5,r6);
		//Alice
		TMSPrincipal p7 = new TMSPrincipal("Alice");
		//credential5:RegistrarB.student<-Alice;
		Credential1 c5 = new Credential1(r6,p7);

		
		
		cres.addCredential3(c1);
		cres.addCredential2(c2);
		cres.addCredential1(c3);
		cres.addCredential2(c4);
		cres.addCredential1(c5);
		
		//credential1
		for(int i = 0; i <cres.getCre1Num(); i ++)
		{
			cres.getCredential1(i).getCredentialPre().addValue(cres.getCredential1(i).getCredentialPost());
		}
		while(true == changeall)
		{
			changeall = false;
			//credential2
			while(true == change)
			{
				change = false;
				for(int i = 0; i < cres.getCre2Num(); i++)
				{
					TMSPrincipal[] p = cres.getCredential2(i).getCredentialPost().getTMSPincipals();
					int j = cres.getCredential2(i).getCredentialPre().getPricipalNum();
					addSemanticsToRole(cres.getCredential2(i).getCredentialPre(), p, cres.getCredential2(i).getCredentialPost().getPricipalNum());
					int k = cres.getCredential2(i).getCredentialPre().getPricipalNum();
					if(j != k)
						change = true;
				}
			}
			//credential3
			change = true;
			while(true == change)
			{
				change = false;
				//calculate the A.r1.r2 's  principal
				for(int i = 0; i < cres.getCre3Num(); i++)
				{
					ComplexRole tempCRole = cres.getCredential3(i).getCredentialPost();
					Role tempRole = tempCRole.getRole();
					RoleName temprn = tempCRole.getRoleName();
					TMSPrincipal[] p = roles.getRolePrincipal(tempRole);
					int tempNum = roles.getRolePrincipalNum(tempRole);
					addSemanticsToComplexRole(tempCRole,p,tempNum,temprn);
				}
				//calculate the credential3 's pre's principal
				for(int i = 0; i < cres.getCre3Num();i++)
				{
					TMSPrincipal[] p = cres.getCredential3(i).getCredentialPost().getTMSPincipals();
					int j = cres.getCredential3(i).getCredentialPre().getPricipalNum();
					addSemanticsToRole(cres.getCredential3(i).getCredentialPre(), p, cres.getCredential3(i).getCredentialPost().getPricipalNum());
					int k = cres.getCredential3(i).getCredentialPre().getPricipalNum();
					if(j != k)
					{
						change = true;
						changeall = true;
					}
				}
			}
		}
		cr.printSemantics();
		r1.printSemantics();
	}
	
	public static void addSemanticsToRole(Role r, TMSPrincipal[] p, int num)
	{
		for(int i = 0; i< num;i++)
		{
			r.addValue(p[i]);
		}
	}
	
	public static void addSemanticsToComplexRole(ComplexRole cr,TMSPrincipal[] p,int num, RoleName rn)
	{
		for(int i = 0; i < num; i++)
		{
			Role tempRole = roles.getRole(p[i],rn);
			if(null != roles.getRolePrincipal(tempRole))
			{
				TMSPrincipal[] tempPrincipal = roles.getRolePrincipal(tempRole);
				int tempNum = roles.getRolePrincipalNum(tempRole);
				for(int j = 0; j < tempNum; j ++)
				{
					cr.addValue(tempPrincipal[j]);
				}
			}
			
		}
	}	
	
}
